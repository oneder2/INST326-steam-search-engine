# APIé€šè®¯æ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ æ£€æŸ¥æ¦‚è¿°

æœ¬æŠ¥å‘Šæ£€æŸ¥å‰ç«¯-åç«¯å’Œåç«¯-æ•°æ®åº“APIé€šè®¯æ˜¯å¦ç¬¦åˆåè®®ï¼Œè¯†åˆ«å¤šä½™æˆ–ç¼ºå°‘çš„å­—æ®µã€‚

**æ£€æŸ¥æ—¥æœŸ**: 2024-12-19  
**æ£€æŸ¥èŒƒå›´**: 
- å‰ç«¯-åç«¯APIæ¥å£
- åç«¯-æ•°æ®åº“æ¥å£ï¼ˆSupabase Schemaï¼‰

---

## ğŸ” ä¸€ã€å‰ç«¯-åç«¯APIé€šè®¯æ£€æŸ¥

### 1.1 æ¸¸æˆæœç´¢æ¥å£ (POST /api/v1/search/games)

#### âœ… è¯·æ±‚æ ¼å¼æ£€æŸ¥
- **å‰ç«¯å‘é€**: `SearchQuerySchema`
- **åç«¯æ¥æ”¶**: `SearchQuerySchema` (Pydantic)
- **çŠ¶æ€**: âœ… **ä¸€è‡´** - å­—æ®µåç§°ã€ç±»å‹ã€çº¦æŸå®Œå…¨åŒ¹é…

#### âŒ å“åº”æ ¼å¼æ£€æŸ¥
- **åç«¯è¿”å›**: `GameResultSchema` (Pydantic)
- **å‰ç«¯æœŸæœ›**: `GameResultSchema` (TypeScript)

**ä¸¥é‡ä¸ä¸€è‡´é—®é¢˜**:

| å­—æ®µ | åç«¯è¿”å› | å‰ç«¯æœŸæœ› | çŠ¶æ€ |
|------|---------|---------|------|
| `game_id` | âœ… å­˜åœ¨ | âŒ **åº”ä¸º `id`** | âŒ **ä¸åŒ¹é…** |
| `title` | âœ… å­˜åœ¨ | âœ… å­˜åœ¨ | âœ… ä¸€è‡´ |
| `description` | âœ… å­˜åœ¨ | âŒ **ä¸å­˜åœ¨** | âŒ **åç«¯å¤šå­—æ®µ** |
| `price` | âœ… å­˜åœ¨ | âœ… å­˜åœ¨ | âœ… ä¸€è‡´ |
| `genres` | âœ… å­˜åœ¨ | âœ… å­˜åœ¨ | âœ… ä¸€è‡´ |
| `coop_type` | âœ… å­˜åœ¨ | âŒ **ä¸å­˜åœ¨** | âŒ **åç«¯å¤šå­—æ®µ** |
| `deck_comp` | âœ… å­˜åœ¨ | âŒ **åº”ä¸º `deck_compatible`** | âŒ **å­—æ®µåä¸åŒ¹é…** |
| `review_status` | âœ… å­˜åœ¨ | âœ… å­˜åœ¨ | âœ… ä¸€è‡´ |
| `release_date` | âœ… å­˜åœ¨ | âŒ **ä¸å­˜åœ¨** | âŒ **åç«¯å¤šå­—æ®µ** |
| `developer` | âœ… å­˜åœ¨ | âŒ **ä¸å­˜åœ¨** | âŒ **åç«¯å¤šå­—æ®µ** |
| `publisher` | âœ… å­˜åœ¨ | âŒ **ä¸å­˜åœ¨** | âŒ **åç«¯å¤šå­—æ®µ** |
| `relevance_score` | âœ… å­˜åœ¨ | âŒ **ä¸å­˜åœ¨** | âŒ **åç«¯å¤šå­—æ®µ** |
| `bm25_score` | âœ… å­˜åœ¨ | âŒ **ä¸å­˜åœ¨** | âŒ **åç«¯å¤šå­—æ®µ** |
| `semantic_score` | âœ… å­˜åœ¨ | âŒ **ä¸å­˜åœ¨** | âŒ **åç«¯å¤šå­—æ®µ** |
| `score` | âŒ **ä¸å­˜åœ¨** | âœ… **å­˜åœ¨ï¼ˆæœŸæœ›ï¼‰** | âŒ **å‰ç«¯æœŸæœ›ä½†åç«¯ç¼ºå¤±** |

**é—®é¢˜æ€»ç»“**:
1. âŒ **å­—æ®µåä¸åŒ¹é…**: `game_id` vs `id`, `deck_comp` vs `deck_compatible`
2. âŒ **åç«¯å¤šå­—æ®µ**: åç«¯è¿”å›13ä¸ªå­—æ®µï¼Œå‰ç«¯åªæœŸæœ›8ä¸ªå­—æ®µ
3. âŒ **å‰ç«¯ç¼ºå¤±å­—æ®µ**: å‰ç«¯æœŸæœ›`score`å­—æ®µï¼Œä½†åç«¯æ²¡æœ‰è¿”å›

**åç«¯å®é™…è¿”å›çš„GameResultç»“æ„** (æ¥è‡ª `search.py:178-196`):
```python
{
    'game_id': int,           # âŒ å‰ç«¯æœŸæœ› 'id'
    'title': str,
    'description': str,       # âŒ å‰ç«¯ä¸éœ€è¦
    'price': float,
    'genres': List[str],
    'coop_type': str,         # âŒ å‰ç«¯ä¸éœ€è¦
    'deck_comp': bool,        # âŒ å‰ç«¯æœŸæœ› 'deck_compatible'
    'review_status': str,
    'release_date': str,      # âŒ å‰ç«¯ä¸éœ€è¦
    'developer': str,         # âŒ å‰ç«¯ä¸éœ€è¦
    'publisher': str,         # âŒ å‰ç«¯ä¸éœ€è¦
    'relevance_score': float, # âŒ å‰ç«¯ä¸éœ€è¦
    'bm25_score': float,      # âŒ å‰ç«¯ä¸éœ€è¦
    'semantic_score': float   # âŒ å‰ç«¯ä¸éœ€è¦
}
# âŒ ç¼ºå¤±: 'score' å­—æ®µï¼ˆå‰ç«¯æœŸæœ›ï¼‰
```

**å‰ç«¯æœŸæœ›çš„GameResultç»“æ„** (æ¥è‡ª `types/api.ts:140-155`):
```typescript
{
    id: number,              // âŒ åç«¯è¿”å› 'game_id'
    title: string,
    score: number,           // âŒ åç«¯ç¼ºå¤±
    price: number,
    genres: string[],
    review_status: ReviewStatus,
    deck_compatible: boolean // âŒ åç«¯è¿”å› 'deck_comp'
}
```

---

### 1.2 æ¸¸æˆè¯¦æƒ…æ¥å£ (GET /api/v1/games/{game_id})

#### âœ… è¯·æ±‚æ ¼å¼æ£€æŸ¥
- **å‰ç«¯å‘é€**: `game_id` (è·¯å¾„å‚æ•°)
- **åç«¯æ¥æ”¶**: `game_id` (Pathå‚æ•°)
- **çŠ¶æ€**: âœ… **ä¸€è‡´**

#### âš ï¸ å“åº”æ ¼å¼æ£€æŸ¥
- **åç«¯è¿”å›**: `GameDetailResponse` (Pydantic)
- **å‰ç«¯æœŸæœ›**: `GameDetailResponse` (TypeScript)

**æ½œåœ¨ä¸ä¸€è‡´é—®é¢˜**:

| å­—æ®µ | åç«¯å®šä¹‰ | å‰ç«¯å®šä¹‰ | çŠ¶æ€ |
|------|---------|---------|------|
| `ranking_metrics` | âŒ **ä¸åœ¨GameDetailResponseä¸­** | âœ… **æœŸæœ›å­˜åœ¨** | âŒ **åç«¯ç¼ºå¤±** |
| `full_description` | âœ… å­˜åœ¨ | âœ… å­˜åœ¨ | âœ… ä¸€è‡´ |
| `screenshots` | âœ… å­˜åœ¨ | âœ… å­˜åœ¨ | âœ… ä¸€è‡´ |
| `trailer_url` | âœ… å­˜åœ¨ | âœ… å­˜åœ¨ | âœ… ä¸€è‡´ |

**é—®é¢˜**: å‰ç«¯æœŸæœ›`ranking_metrics`å­—æ®µï¼ˆç±»å‹ä¸º`RankingMetrics`ï¼‰ï¼Œä½†åç«¯`GameDetailResponse`ä¸­æ²¡æœ‰å®šä¹‰æ­¤å­—æ®µã€‚

---

### 1.3 æœç´¢å»ºè®®æ¥å£ (GET /api/v1/search/suggest)

#### âœ… è¯·æ±‚æ ¼å¼æ£€æŸ¥
- **å‰ç«¯å‘é€**: `prefix` (æŸ¥è¯¢å‚æ•°)
- **åç«¯æ¥æ”¶**: `prefix` (Queryå‚æ•°)
- **çŠ¶æ€**: âœ… **ä¸€è‡´**

#### âœ… å“åº”æ ¼å¼æ£€æŸ¥
- **åç«¯è¿”å›**: `SearchSuggestionsResponse`
- **å‰ç«¯æœŸæœ›**: `SearchSuggestionsResponse`
- **çŠ¶æ€**: âœ… **åŸºæœ¬ä¸€è‡´**ï¼ˆå­—æ®µåç§°å’Œç±»å‹åŒ¹é…ï¼‰

---

## ğŸ” äºŒã€åç«¯-æ•°æ®åº“æ¥å£æ£€æŸ¥

### 2.1 Supabase Schema vs åç«¯æ¨¡å‹

#### âœ… æ•°æ®åº“Schema (å®é™…éƒ¨ç½²)
```sql
steam.games_prod (
    appid bigint PRIMARY KEY,           -- âœ… ä¸»é”®
    name text NOT NULL,                 -- âœ… æ¸¸æˆåç§°
    release_date date,                  -- âœ… å‘å¸ƒæ—¥æœŸ
    genres jsonb,                       -- âœ… ç±»å‹ï¼ˆJSONBï¼‰
    categories jsonb,                   -- âœ… åˆ†ç±»ï¼ˆJSONBï¼‰
    short_description text,             -- âœ… ç®€çŸ­æè¿°
    detailed_desc text,                 -- âœ… è¯¦ç»†æè¿°
    price_cents integer,                -- âœ… ä»·æ ¼ï¼ˆåˆ†ï¼‰
    total_reviews integer,              -- âœ… æ€»è¯„è®ºæ•°
    dlc_count integer,                  -- âš ï¸ åç«¯æœªä½¿ç”¨
    type text,                          -- âš ï¸ åç«¯æœªä½¿ç”¨
    search_tsv text,                    -- âš ï¸ åç«¯æœªä½¿ç”¨
    created_at timestamp,               -- âš ï¸ åç«¯æœªä½¿ç”¨
    updated_at timestamp                -- âš ï¸ åç«¯æœªä½¿ç”¨
)
```

#### âœ… åç«¯GameInfoæ¨¡å‹
```python
GameInfo (
    game_id: int,              # âœ… æ˜ å°„è‡ª appid
    title: str,                # âœ… æ˜ å°„è‡ª name
    description: str,          # âœ… æ˜ å°„è‡ª short_description/detailed_desc
    price: float,              # âœ… æ˜ å°„è‡ª price_cents / 100.0
    genres: List[str],         # âœ… æ˜ å°„è‡ª genres (jsonb)
    coop_type: Optional[str],  # âš ï¸ ä»categoriesæå–ï¼ˆéç›´æ¥å­—æ®µï¼‰
    deck_comp: bool,           # âš ï¸ ä»categoriesæå–ï¼ˆéç›´æ¥å­—æ®µï¼‰
    review_status: str,        # âš ï¸ ä»total_reviewsè®¡ç®—ï¼ˆéç›´æ¥å­—æ®µï¼‰
    release_date: Optional[str], # âœ… æ˜ å°„è‡ª release_date
    developer: Optional[str],   # âŒ æ•°æ®åº“ä¸å­˜åœ¨ï¼Œå§‹ç»ˆä¸ºNone
    publisher: Optional[str]    # âŒ æ•°æ®åº“ä¸å­˜åœ¨ï¼Œå§‹ç»ˆä¸ºNone
)
```

#### âœ… å­—æ®µæ˜ å°„æ£€æŸ¥

| æ•°æ®åº“å­—æ®µ | åç«¯å­—æ®µ | æ˜ å°„æ–¹å¼ | çŠ¶æ€ |
|-----------|---------|---------|------|
| `appid` | `game_id` | ç›´æ¥æ˜ å°„ | âœ… æ­£ç¡® |
| `name` | `title` | ç›´æ¥æ˜ å°„ | âœ… æ­£ç¡® |
| `short_description` / `detailed_desc` | `description` | ä¼˜å…ˆshort_descriptionï¼Œå¦åˆ™detailed_desc | âœ… æ­£ç¡® |
| `price_cents` | `price` | price_cents / 100.0 | âœ… æ­£ç¡® |
| `genres` (jsonb) | `genres` | JSONè§£æä¸ºList[str] | âœ… æ­£ç¡® |
| `release_date` (date) | `release_date` | è½¬æ¢ä¸ºå­—ç¬¦ä¸² | âœ… æ­£ç¡® |
| `categories` (jsonb) | `coop_type` | ä»categoriesä¸­æå– | âœ… æ­£ç¡® |
| `categories` (jsonb) | `deck_comp` | ä»categoriesä¸­æå– | âœ… æ­£ç¡® |
| `total_reviews` | `review_status` | æ ¹æ®total_reviewsè®¡ç®— | âš ï¸ ç®€åŒ–å¤„ç† |
| - | `developer` | ä¸å­˜åœ¨ï¼Œè®¾ä¸ºNone | âŒ æ•°æ®åº“ç¼ºå¤±å­—æ®µ |
| - | `publisher` | ä¸å­˜åœ¨ï¼Œè®¾ä¸ºNone | âŒ æ•°æ®åº“ç¼ºå¤±å­—æ®µ |

#### âš ï¸ é—®é¢˜è¯†åˆ«

1. **æ•°æ®åº“å­˜åœ¨ä½†åç«¯æœªä½¿ç”¨çš„å­—æ®µ**:
   - `dlc_count` - DLCæ•°é‡ï¼Œåç«¯æœªä½¿ç”¨
   - `type` - æ¸¸æˆç±»å‹ï¼Œåç«¯æœªä½¿ç”¨
   - `search_tsv` - å…¨æ–‡æœç´¢å‘é‡ï¼Œåç«¯æœªä½¿ç”¨ï¼ˆå¯èƒ½ç”¨äºæœç´¢ç´¢å¼•ï¼‰
   - `created_at` - åˆ›å»ºæ—¶é—´ï¼Œåç«¯æœªä½¿ç”¨
   - `updated_at` - æ›´æ–°æ—¶é—´ï¼Œåç«¯æœªä½¿ç”¨

2. **åç«¯å­˜åœ¨ä½†æ•°æ®åº“ç¼ºå¤±çš„å­—æ®µ**:
   - `developer` - å¼€å‘è€…ï¼Œæ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œåç«¯å§‹ç»ˆè¿”å›None
   - `publisher` - å‘è¡Œå•†ï¼Œæ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œåç«¯å§‹ç»ˆè¿”å›None

3. **æ•°æ®è½¬æ¢é€»è¾‘**:
   - âœ… `coop_type` ä» `categories` JSONBä¸­æå– - å®ç°æ­£ç¡®
   - âœ… `deck_comp` ä» `categories` JSONBä¸­æå– - å®ç°æ­£ç¡®
   - âš ï¸ `review_status` æ ¹æ® `total_reviews` è®¡ç®— - ç®€åŒ–å¤„ç†ï¼ˆåº”è¯¥åŸºäºå®é™…è¯„ä»·åˆ†æ•°ï¼‰

---

### 2.2 æ•°æ®åº“æŸ¥è¯¢æ£€æŸ¥

#### âœ… SupabaseProvideræŸ¥è¯¢
- **æŸ¥è¯¢æ–¹å¼**: ä½¿ç”¨Supabase Pythonå®¢æˆ·ç«¯
- **è¡¨å**: `steam.games_prod` (é€šè¿‡schema.tableæ ¼å¼)
- **å­—æ®µæ˜ å°„**: ä½¿ç”¨`appid`ä½œä¸ºä¸»é”®æŸ¥è¯¢ âœ… æ­£ç¡®

#### âœ… æŸ¥è¯¢è¯­å¥ç¤ºä¾‹
```python
# å•æ¸¸æˆæŸ¥è¯¢
client.table("steam.games_prod").select("*").eq("appid", game_id).execute()

# æ‰¹é‡æŸ¥è¯¢
client.table("steam.games_prod").select("*").in_("appid", game_ids).execute()
```

**çŠ¶æ€**: âœ… **æ­£ç¡®** - ä½¿ç”¨`appid`å­—æ®µåŒ¹é…æ•°æ®åº“schema

---

## ğŸ“Š ä¸‰ã€é—®é¢˜æ±‡æ€»

### 3.1 ä¸¥é‡é—®é¢˜ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

#### ğŸ”´ é—®é¢˜1: å‰ç«¯-åç«¯GameResultå­—æ®µä¸åŒ¹é…
**ä½ç½®**: `POST /api/v1/search/games` å“åº”
**å½±å“**: å‰ç«¯æ— æ³•æ­£ç¡®è§£æåç«¯è¿”å›çš„æ•°æ®
**è¯¦æƒ…**:
- å­—æ®µåä¸åŒ¹é…: `game_id` vs `id`, `deck_comp` vs `deck_compatible`
- åç«¯å¤šå­—æ®µ: è¿”å›13ä¸ªå­—æ®µï¼Œå‰ç«¯åªæœŸæœ›8ä¸ªå­—æ®µ
- å‰ç«¯æœŸæœ›å­—æ®µç¼ºå¤±: `score`å­—æ®µä¸å­˜åœ¨

**å»ºè®®ä¿®å¤**:
1. ç»Ÿä¸€å­—æ®µåç§°ï¼šä½¿ç”¨`id`ä»£æ›¿`game_id`ï¼Œæˆ–å‰ç«¯ä½¿ç”¨`game_id`
2. æ·»åŠ `score`å­—æ®µï¼ˆä»`relevance_score`æ˜ å°„ï¼‰
3. ç§»é™¤å‰ç«¯ä¸éœ€è¦çš„å­—æ®µï¼Œæˆ–æ›´æ–°å‰ç«¯ç±»å‹å®šä¹‰ä»¥åŒ…å«æ‰€æœ‰å­—æ®µ

#### ğŸ”´ é—®é¢˜2: GameDetailResponseç¼ºå°‘ranking_metricså­—æ®µ
**ä½ç½®**: `GET /api/v1/games/{game_id}` å“åº”
**å½±å“**: å‰ç«¯æœŸæœ›ä½†åç«¯æœªæä¾›
**è¯¦æƒ…**:
- å‰ç«¯`GameDetailResponse`æœŸæœ›`ranking_metrics: RankingMetrics`
- åç«¯`GameDetailResponse`ä¸­æ²¡æœ‰æ­¤å­—æ®µ

**å»ºè®®ä¿®å¤**:
1. åœ¨åç«¯`GameDetailResponse`ä¸­æ·»åŠ `ranking_metrics`å­—æ®µ
2. æˆ–ä»å‰ç«¯ç±»å‹å®šä¹‰ä¸­ç§»é™¤`ranking_metrics`

### 3.2 ä¸­ç­‰é—®é¢˜ï¼ˆå»ºè®®ä¿®å¤ï¼‰

#### ğŸŸ¡ é—®é¢˜3: æ•°æ®åº“å­—æ®µæœªå……åˆ†åˆ©ç”¨
**ä½ç½®**: Supabase Schema
**å½±å“**: éƒ¨åˆ†æ•°æ®æœªè¢«ä½¿ç”¨
**è¯¦æƒ…**:
- `dlc_count` - å¯ç”¨äºæ˜¾ç¤ºDLCä¿¡æ¯
- `type` - å¯ç”¨äºæ¸¸æˆåˆ†ç±»
- `search_tsv` - å¯èƒ½ç”¨äºå…¨æ–‡æœç´¢ä¼˜åŒ–
- `created_at`, `updated_at` - å¯ç”¨äºæ•°æ®ç®¡ç†

**å»ºè®®**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®šæ˜¯å¦ä½¿ç”¨è¿™äº›å­—æ®µ

#### ğŸŸ¡ é—®é¢˜4: åç«¯æ¨¡å‹åŒ…å«æ•°æ®åº“ä¸å­˜åœ¨çš„å­—æ®µ
**ä½ç½®**: `GameInfo.developer`, `GameInfo.publisher`
**å½±å“**: è¿™äº›å­—æ®µå§‹ç»ˆä¸ºNoneï¼Œå¯èƒ½é€ æˆæ··æ·†
**è¯¦æƒ…**:
- æ•°æ®åº“schemaä¸­æ²¡æœ‰`developer`å’Œ`publisher`å­—æ®µ
- åç«¯æ¨¡å‹å®šä¹‰äº†è¿™äº›å­—æ®µï¼Œä½†å§‹ç»ˆè¿”å›None

**å»ºè®®**:
1. å¦‚æœç¡®å®éœ€è¦è¿™äº›å­—æ®µï¼Œåº”åœ¨æ•°æ®åº“ä¸­æ·»åŠ 
2. å¦‚æœä¸éœ€è¦ï¼Œåº”ä»åç«¯æ¨¡å‹ä¸­ç§»é™¤

### 3.3 è½»å¾®é—®é¢˜ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰

#### ğŸŸ¢ é—®é¢˜5: review_statusè®¡ç®—ç®€åŒ–
**ä½ç½®**: `SupabaseProvider._calculate_review_status()`
**å½±å“**: è¯„ä»·çŠ¶æ€å¯èƒ½ä¸å‡†ç¡®
**è¯¦æƒ…**:
- å½“å‰ä»…æ ¹æ®`total_reviews`æ•°é‡è®¡ç®—
- åº”è¯¥åŸºäºå®é™…è¯„ä»·åˆ†æ•°ï¼ˆä½†æ•°æ®åº“ä¸­æ²¡æœ‰æ­¤å­—æ®µï¼‰

**å»ºè®®**: å¦‚æœåç»­æœ‰è¯„ä»·åˆ†æ•°æ•°æ®ï¼Œåº”æ›´æ–°è®¡ç®—é€»è¾‘

---

## ğŸ“‹ å››ã€æ£€æŸ¥æ¸…å•

### å‰ç«¯-åç«¯æ¥å£
- [ ] âœ… æœç´¢è¯·æ±‚æ ¼å¼ä¸€è‡´
- [x] âŒ **æœç´¢å“åº”æ ¼å¼ä¸ä¸€è‡´**ï¼ˆä¸¥é‡ï¼‰
- [ ] âœ… æœç´¢å»ºè®®è¯·æ±‚/å“åº”æ ¼å¼ä¸€è‡´
- [ ] âœ… æ¸¸æˆè¯¦æƒ…è¯·æ±‚æ ¼å¼ä¸€è‡´
- [x] âš ï¸ **æ¸¸æˆè¯¦æƒ…å“åº”æ ¼å¼éƒ¨åˆ†ä¸ä¸€è‡´**ï¼ˆç¼ºå°‘ranking_metricsï¼‰

### åç«¯-æ•°æ®åº“æ¥å£
- [ ] âœ… å­—æ®µæ˜ å°„æ­£ç¡®ï¼ˆappid â†’ game_idï¼‰
- [ ] âœ… æ•°æ®è½¬æ¢é€»è¾‘æ­£ç¡®
- [ ] âš ï¸ éƒ¨åˆ†æ•°æ®åº“å­—æ®µæœªä½¿ç”¨
- [ ] âš ï¸ éƒ¨åˆ†åç«¯å­—æ®µåœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨

---

## ğŸ¯ äº”ã€ä¿®å¤ä¼˜å…ˆçº§

### P0 - ç«‹å³ä¿®å¤ï¼ˆé˜»å¡æ€§é—®é¢˜ï¼‰
1. **ä¿®å¤GameResultå­—æ®µä¸åŒ¹é…é—®é¢˜** - å¯¼è‡´å‰ç«¯æ— æ³•æ­£ç¡®è§£ææ•°æ®
2. **ä¿®å¤GameDetailResponseç¼ºå°‘ranking_metrics** - ç±»å‹ä¸åŒ¹é…

### P1 - é«˜ä¼˜å…ˆçº§ï¼ˆå½±å“åŠŸèƒ½ï¼‰
3. **ç»Ÿä¸€å­—æ®µå‘½åè§„èŒƒ** - æé«˜ä»£ç å¯ç»´æŠ¤æ€§
4. **å¤„ç†æ•°æ®åº“ç¼ºå¤±å­—æ®µ** - ç§»é™¤æˆ–æ·»åŠ ç›¸åº”å­—æ®µ

### P2 - ä¸­ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–å»ºè®®ï¼‰
5. **å……åˆ†åˆ©ç”¨æ•°æ®åº“å­—æ®µ** - æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®š
6. **ä¼˜åŒ–review_statusè®¡ç®—é€»è¾‘** - æé«˜å‡†ç¡®æ€§

---

## ğŸ“ å…­ã€è¯¦ç»†ä¿®å¤å»ºè®®

### ä¿®å¤å»ºè®®1: ç»Ÿä¸€GameResultå­—æ®µ

**æ–¹æ¡ˆA: ä¿®æ”¹åç«¯ä»¥åŒ¹é…å‰ç«¯**
```python
# ä¿®æ”¹ search.py ä¸­çš„ GameResult æ„å»ºé€»è¾‘
game_result = {
    'id': result.game.game_id,  # æ”¹ä¸º id
    'title': result.game.title,
    'score': min(result.score / 10.0, 1.0),  # æ·»åŠ  score
    'price': result.game.price,
    'genres': result.game.genres,
    'review_status': result.game.review_status,
    'deck_compatible': result.game.deck_comp,  # æ”¹ä¸º deck_compatible
    # ç§»é™¤å…¶ä»–å‰ç«¯ä¸éœ€è¦çš„å­—æ®µ
}
```

**æ–¹æ¡ˆB: ä¿®æ”¹å‰ç«¯ä»¥åŒ¹é…åç«¯**
```typescript
// ä¿®æ”¹ types/api.ts ä¸­çš„ GameResult æ¥å£
export interface GameResult {
  game_id: number;  // æ”¹ä¸º game_id
  title: string;
  description?: string;  // æ·»åŠ å¯é€‰å­—æ®µ
  price: number;
  genres: string[];
  coop_type?: string;  // æ·»åŠ å¯é€‰å­—æ®µ
  deck_comp: boolean;  // æ”¹ä¸º deck_comp
  review_status: ReviewStatus;
  release_date?: string;  // æ·»åŠ å¯é€‰å­—æ®µ
  developer?: string;  // æ·»åŠ å¯é€‰å­—æ®µ
  publisher?: string;  // æ·»åŠ å¯é€‰å­—æ®µ
  relevance_score?: number;  // æ·»åŠ å¯é€‰å­—æ®µ
  bm25_score?: number;  // æ·»åŠ å¯é€‰å­—æ®µ
  semantic_score?: number;  // æ·»åŠ å¯é€‰å­—æ®µ
}
```

**æ¨èæ–¹æ¡ˆ**: æ–¹æ¡ˆA - åç«¯åº”è¯¥è¿”å›å‰ç«¯æœŸæœ›çš„æ ¼å¼

### ä¿®å¤å»ºè®®2: æ·»åŠ ranking_metricså­—æ®µ

```python
# åœ¨ GameDetailResponse ä¸­æ·»åŠ 
class GameDetailResponse(BaseModel):
    # ... ç°æœ‰å­—æ®µ ...
    ranking_metrics: Optional[RankingMetrics] = Field(None, description="æ’åæŒ‡æ ‡")
    
    # æˆ–åœ¨è¿”å›æ—¶æ„å»º
    ranking_metrics=RankingMetrics(
        review_stability=0.0,  # ä»å®é™…æ•°æ®è®¡ç®—
        player_activity=0.0  # ä»å®é™…æ•°æ®è®¡ç®—
    )
```

---

## âœ… ä¸ƒã€æ£€æŸ¥ç»“è®º

1. **å‰ç«¯-åç«¯æ¥å£**: âŒ **å­˜åœ¨ä¸¥é‡ä¸ä¸€è‡´é—®é¢˜**ï¼Œä¸»è¦é›†ä¸­åœ¨GameResultå­—æ®µå®šä¹‰
2. **åç«¯-æ•°æ®åº“æ¥å£**: âœ… **åŸºæœ¬æ­£ç¡®**ï¼Œå­—æ®µæ˜ å°„å’Œæ•°æ®è½¬æ¢é€»è¾‘æ­£ç¡®ï¼Œä½†å­˜åœ¨æœªä½¿ç”¨å­—æ®µå’Œç¼ºå¤±å­—æ®µ

**æ€»ä½“è¯„ä¼°**: âš ï¸ **éœ€è¦ç«‹å³ä¿®å¤å‰ç«¯-åç«¯æ¥å£çš„ä¸ä¸€è‡´é—®é¢˜**

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2024-12-19  
**æ£€æŸ¥äººå‘˜**: AI Assistant  
**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: æ ¹æ®ä¿®å¤ä¼˜å…ˆçº§ä¿®å¤å‘ç°çš„é—®é¢˜

